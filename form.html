<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="widtd=device-widtd, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="form-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header>
        <div class="header">
                <img alt="logo.png" src="/imagenes/buhoLogo.png" width="50px" height="50px"> 
                <h1>OwlCinema</h1>
                <img id="search" alt="search.png" src="/imagenes/search.png" width=45px>
                <i class="fa-solid fa-circle-user" style="color: #ffffff; font-size: 35px;" "></i>  
        </div>
        <div class="navbar">
            <a href="index.html">Inicio</a>
            <a href="resena.html">Rese√±as</a>
            <a href="#">Reservar entradas</a>
        </div>
    </header>

    <div class="container">
        <div class="contenido">
            <div class="tabla">
                <h3>Elija sus asientos:</h3>
                <table id="tablaAsientos">
                    <tr><td></td>
                        <td>1</td>
                        <td>2</td>
                        <td>3</td>
                        <td>4</td>
                        <td>5</td>
                        <td>6</td>
                        <td>7</td>
                        <td>8</td>
                        <td>9</td>
                        <td>10</td>
                    </tr>
                    <tr>
                        <td>a</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>b</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>c</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>d</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>e</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>f</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>g</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>h</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>
                    <tr>
                        <td>i</td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                        <td class="clickable"><i class="fa-solid fa-couch "></i></td>
                    </tr>    
                </table>
            </div>
            <div class="formulario">
                <form class="frm" onsubmit="return validar()">
                    <h3>Elija la fecha:</h3>
                    <div class="fechas">
                        <div id="fechaHoy"></div>
                        <div id="fechaMan"></div>
                        <div id="fechaPasado"></p></div>
                    </div>
                    <h3>Elija la Hora:</h3>
                    <div class="horas">
                        <div><p>8:00</p></div>
                        <div><p>9:00</p></div>
                        <div><p>10:00</p></div>
                        <div><p>11:00</p></div>
                    </div>
                    <div>
                        <label for="txtNombre">Nombre:</label><br>
                        <input type="text" id="txtNombre">  
                    </div>
                    <div>
                        <label for="txtApellido">Apellido:</label><br>
                        <input type="text" id="txtApellido">  
                    </div>
                    <div>
                        <label for="txtDni">Dni:</label><br>
                        <input type="text" id="txtDni">  
                    </div>
                    <div>
                        <label for="txtTarjeta">Numero de Tarjeta:</label><br>
                        <input type="text" id="txtTarjeta">  
                    </div>
                    <div>
                        <label for="metodoPago">Inserte metodo de pago:</label>
                        <select name="metodoPago" id="metodoPago">
                            <option value="visa">Visa</option>
                            <option value="mastercard">Mastercard</option>
                        </select>
                    </div>
                    <div><button type="submit">Reservar entrada</button></div>              
                </form>
                <div class="salida" id="salida"></div>
            </div>
            <div class="peliculaImagen" id="peliculaImagen">
                <label for="selPelicula">Seleccionar pelicula:</label>
                <select name="selPelicula" id="selPelicula"></select>  
            </div>
        </div>        
    </div>
    
    <footer>
        <div class="footer">
            <div class="logo">
                <img alt="logo.png" src="imagenes/buhoLogo.png" width="35px" height="35px">
                <div>
                <h2>OwlCinema</h2>
                </div>
            </div>
            <ul class="social">
              <li><a href="#"><i class="fa-brands fa-facebook" style="color: #ffffff; font-size: 22px;"></i></a></li>
              <li><a href="#"><i class="fa-brands fa-x-twitter" style="color: #ffffff; font-size: 22px;"></i></a></li>
              <li><a href="#"><i class="fa-brands fa-instagram" style="color: #ffffff; font-size: 22px;"></i></a></li>
              <li><a href="#"><i class="fa-brands fa-tiktok" style="color: #ffffff; font-size: 22px;"></i></a></li>
            </ul>
        </div>
    </footer>

    <script>
            // Peliculas para elegir
            const peliculas = new Map();
            peliculas.set("El planeta de los simios","imagenes/8633-el-planeta-de-los-simios-nuevo-reino.jpg");
            peliculas.set("Amigos imaginarios","imagenes/9759-amigos-imaginarios.jpg");
            peliculas.set("Garfield fuera de casa","imagenes/9567-garfield-fuera-de-casa.jpg");
            peliculas.set("Kung fu panda 4","imagenes/4450-kung-fu-panda-4.jpg");
            peliculas.set("Desafiantes","imagenes/9401-desafiantes.jpg");
            peliculas.set("Profesion peligro","imagenes/9618-profesion-peligro.jpg");
            peliculas.set("Tarot de la muerte","imagenes/9715-tarot-de-la-muerte.jpg");
            peliculas.set("Monkey man el despertar de la bestia","imagenes/9735-monkey-man-el-despertar-de-la-bestia.jpg");
            peliculas.set("Lo mejor esta por venir","imagenes/9754-lo-mejor-esta-por-venir.jpg");
            peliculas.set("Godzilla y Kong el nuevo imperio","imagenes/9502-godzilla-y-kong-el-nuevo-imperio.jpg");

            // Formulario
            let txtNombre = document.getElementById("txtNombre");
            let txtApellido = document.getElementById("txtApellido");
            let txtDni = document.getElementById("txtDni");
            let txtTarjeta = document.getElementById("txtTarjeta");
            let selMetodo = document.getElementById("metodoPago");
            let inNombre = document.getElementById("")
            let fechaAct = "";
            let horaAct = "";
            const fechas = document.querySelectorAll(".fechas div");
            const horas = document.querySelectorAll(".horas div");
            let selPelicula = document.getElementById("selPelicula");
            let divPelicula = document.getElementById("peliculaImagen");

            // A√±adir peliculas a select
            peliculas.forEach((clave,valor) => {
               const optElem = document.createElement("option");
               optElem.textContent = valor;
               selPelicula.appendChild(optElem);
            });

            // Mostrar pelicula
            function mostrarPelicula(){
                divPelicula.querySelectorAll("img").forEach(img => img.remove());
                const imgPeli = document.createElement("img");
                imgPeli.classList.add("peliculaImagen");
                imgPeli.src = peliculas.get(selPelicula.value);
                divPelicula.appendChild(imgPeli);
            }
            
            selPelicula.selectIndex = 0;
            mostrarPelicula();
            selPelicula.addEventListener("change", mostrarPelicula);

            // Asignar fecha actual a botones
            function formatearFecha(fecha) {
            let dia = String(fecha.getDate()).padStart(2, "0");
            let mes = String(fecha.getMonth() + 1).padStart(2, "0"); 
            return `${dia}/${mes}`;
            }

            function crearFechaElemento(divId, fecha) {
            let div = document.getElementById(divId);
            let fechaElem = document.createElement("p");
            fechaElem.textContent = formatearFecha(fecha);
            div.appendChild(fechaElem);
            }

            let hoy = new Date();
            let ma√±ana = new Date(hoy);
            ma√±ana.setDate(hoy.getDate() + 1);
            let pasadoMa√±ana = new Date(hoy);
            pasadoMa√±ana.setDate(hoy.getDate() + 2);

            crearFechaElemento("fechaHoy", hoy);
            crearFechaElemento("fechaMan", ma√±ana);
            crearFechaElemento("fechaPasado", pasadoMa√±ana);
            
            // Asignar fecha y hora por defecto
            fechas[0].classList.add("fechaHoraActiva");
            fechaAct = fechas[0].textContent;
            horas[0].classList.add("fechaHoraActiva");
            horaAct = horas[0].textContent;

            // Tabla asientos
            const tabla = document.getElementById("tabla")
            const celdas = document.querySelectorAll("#tablaAsientos td");
            const filas = ["a","b","c","d","e","f","g","h","i"];
            const columnas = [1,2,3,4,5,6,7,8,9,10];

            // Asignar id a cada celda
            let index = 0;
            for(let i = 0; i < filas.length+1; i++){
                for(let j = 0; j < columnas.length+1; j++){
                    if(i>0 && j >0){
                        const celda = celdas[index];
                        celdas[index].id = `${filas[i-1]}${columnas[j-1]}`;
                        celda.classList.add("blanco");
                    }      
                    index ++;     
                }
            }

            // Evento para asignar clase color verde a cada asiento
            celdas.forEach(celda => {
                if (celda.classList.contains("clickable")){
                    celda.addEventListener("click",() => {
                        if (celda.classList.contains("verde")) {
                            celda.classList.remove("verde");
                            celda.classList.add("blanco");
                        } else {
                            celda.classList.add("verde");
                            celda.classList.remove("blanco");
                        }
                    });
                }  
            })

           // Eventos para seleccionar fecha y hora
            fechas.forEach(fecha => {
                fecha.addEventListener("click",() => {
                fechas.forEach(f => f.classList.remove("fechaHoraActiva"));
                fecha.classList.add("fechaHoraActiva");
                fechaAct = fecha.textContent;
                })
            })

            horas.forEach(hora => {
                hora.addEventListener("click",() => {
                horas.forEach(h => h.classList.remove("fechaHoraActiva"));
                hora.classList.add("fechaHoraActiva");
                horaAct = hora.textContent;
                })
            })

            function validar(){
                const nombre = txtNombre.value;
                const apellido = txtApellido.value;
                const dni = txtDni.value;
                const tarjeta = txtTarjeta.value;
                const metodo = selMetodo.value;
                const regex_string = /^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë√º√ú\s]+$/;
                const regex_num = /^[0-9]+$/;
                
                // Comprobar campos vac√≠os
                if(nombre.length == 0){
                    txtNombre.classList.add("bordeAmarillo");
                }else{
                    txtNombre.classList.remove("bordeAmarillo"); 
                }
                if(apellido.length == 0){
                    txtApellido.classList.add("bordeAmarillo");
                }else{
                    txtApellido.classList.remove("bordeAmarillo");
                }
                if(dni.length == 0){
                    txtDni.classList.add("bordeAmarillo");
                }else{
                    txtDni.classList.remove("bordeAmarillo");
                }
                if(tarjeta.length == 0){
                    txtTarjeta.classList.add("bordeAmarillo")
                }else{
                    txtTarjeta.classList.remove("bordeAmarillo")
                }

                // Comprobar patterns
                if(!regex_string.test(nombre) && !txtNombre.classList.contains("bordeAmarillo")){
                    txtNombre.classList.add("bordeRojo");
                }else{
                    txtNombre.classList.remove("bordeRojo");
                }
                if(!regex_string.test(apellido) && !txtApellido.classList.contains("bordeAmarillo")){
                    txtApellido.classList.add("bordeRojo");
                }else{
                    txtApellido.classList.remove("bordeRojo");
                }
                if(!regex_num.test(dni) && !txtDni.classList.contains("bordeAmarillo")){
                    txtDni.classList.add("bordeRojo");
                }else{
                    txtDni.classList.remove("bordeRojo");
                }
                if(!regex_num.test(tarjeta) && !txtTarjeta.classList.contains("bordeAmarillo")){
                    txtTarjeta.classList.add("bordeRojo");
                }else{
                    txtTarjeta.classList.remove("bordeRojo");
                }

                // Elementos
                const celdasVerdes = Array.from(celdas).filter(celda => celda.classList.contains("verde"));
                const idVerdes = celdasVerdes.map(celda => celda.id);

                const celdaElem = document.createElement("p")  
                celdaElem.textContent = `Asientos Reservados: ${idVerdes.join(",")}`;

                const nombreApellidoElem = document.createElement("p");
                nombreApellidoElem.textContent = `Nombre y Apellido: ${nombre}  ${apellido}`;

                const dniElem = document.createElement("p");
                dniElem.textContent = `Dni: ${dni}`;

                const fechaHoraElem = document.createElement("p");
                fechaHoraElem.textContent = `Fecha: ${fechaAct} Hora: ${horaAct}`;

                const tarjetaMetodoElem = document.createElement("p");
                tarjetaMetodoElem.textContent = `Num tarjeta: ${tarjeta} Met.Pago: ${metodo}`;

                const salidaDiv = document.getElementById("salida");
                salidaDiv.innerHTML = "";

                // Variables de control de validacion
                let camposInvalidos = false;
                let camposIncompletos = false;
                let asientosVacios = false;
                let asientosLim = false;

                // Elemento que indica que hay campos vacios
                if(txtNombre.classList.contains("bordeAmarillo") || txtApellido.classList.contains("bordeAmarillo") || txtDni.classList.contains("bordeAmarillo") || txtTarjeta.classList.contains("bordeAmarillo")){
                    const camposIncompletosElem = document.createElement("p");
                    camposIncompletosElem.textContent = `Hay campos incompletos`;
                    camposIncompletosElem.classList.add("amarillo");
                    salidaDiv.appendChild(camposIncompletosElem);
                    camposIncompletos = true;
                }else{
                    camposIncompletos = false;
                }
                
                // Elemento que indica que hay campos invalidos
                if(txtNombre.classList.contains("bordeRojo") || txtApellido.classList.contains("bordeRojo") || txtDni.classList.contains("bordeRojo") || txtTarjeta.classList.contains("bordeRojo")){
                    const camposInvalidosElem = document.createElement("p");
                    camposInvalidosElem.textContent = `Hay campos invalidos`;
                    camposInvalidosElem.classList.add("rojo");
                    salidaDiv.appendChild(camposInvalidosElem); 
                    camposInvalidos = true;
                }else{
                    camposInvalidos = false;
                }

                // Elemento que indica que no se reservo ningun asiento
                if(celdasVerdes.length == 0){
                    const asientosVaciosElem = document.createElement("p");
                    asientosVaciosElem.textContent = `No se ha reservado ningun asiento`;
                    asientosVaciosElem.classList.add("verde");
                    salidaDiv.appendChild(asientosVaciosElem);
                    asientosVacios = true;
                }else{
                    asientosVacios = false;
                }
                
                // Elemento que indica que se ha superado el limite de reserva de asientos
                if(celdasVerdes.length > 5){
                    const asientosLimElem = document.createElement("p");
                    asientosLimElem.textContent = `Se ha superado el numero de reserva de asientos de 5`;
                    asientosLimElem.classList.add("verde");
                    salidaDiv.appendChild(asientosLimElem);
                    asientosLim = true;
                }else{
                    asientosLim = false;
                }

                // Mostrar datos ingresados
                if(!camposInvalidos && !camposIncompletos && !asientosVacios && !asientosLim){
                    salidaDiv.appendChild(celdaElem);
                    salidaDiv.appendChild(dniElem);
                    salidaDiv.appendChild(nombreApellidoElem);
                    salidaDiv.appendChild(fechaHoraElem);
                    salidaDiv.appendChild(tarjetaMetodoElem); 
                }
                return false;
            }
    </script>
</body>
</html>